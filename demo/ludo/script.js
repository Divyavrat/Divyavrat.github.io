let testing=!1,mode="cpu",path=[],home=[],turn=1,dice=1,stopInput=!0,step="dice",safehouses=[0,13,26,39,47,8,21,34],color=["#98D8AA","#A5D7E8","#FA9884","#F3E99F"],tokenColors=["#41644A","#3C486B","#D21312","#F7C04A"];const random=Math.random,c=testing?console.log:()=>{},keypress=e=>{"r"!=e.key&&"R"!=e.key||resetGame()};function isTouchDevice(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints}const clickIndex=(e=-1,o=-1)=>{"object"==typeof e||stopInput||-1==e&&-1==o||(c(e,o),"cpu"==mode||"dice"==step&&o==turn-1?playDice():"play"==step&&6==dice&&o==turn-1&&home[turn-1]&&!path[safehouses[turn-1]]?(moveTokenOut(),step="dice",render()):"play"==step&&path[e]==turn&&playToken(e))},diceroll=e=>parseInt(6*random())+1,diceImg=e=>"pass"==mode&&"dice"==step?'<img src="dice.gif" />':`<span class="dice">${1==dice?"⚀":2==dice?"⚁":3==dice?"⚂":4==dice?"⚃":5==dice?"⚄":"⚅"}</span>`,square=(e=-1,o="#F1F6F9",r=testing?e:"")=>`<div
ontouchstart="clickIndex(${e})"
onclick="clickIndex(${e})"
style="color:${path[e]?tokenColors[path[e]-1]:"white"}; background:${o};">
    ${path[e]?"♟":r}
</div>`,row6=(o,r=0,t=0,s="♟")=>[1,2,3,4,5,6].map(e=>`<div
ontouchstart="clickIndex(-1, ${o})"
onclick="clickIndex(-1, ${o})"
style="color:${"♟"==s?tokenColors[o]:"white"};border:0;background:#F1F6F9; background2:${color[o]};">
    ${e==r||e==t?s:""}
</div>`).join(""),nextIndex=(e,o=dice)=>{let r=e+o;return 1==turn&&50<r&&e<52?r++:1==turn&&57<r?r=57:2==turn&&e<=11&&11<r&&r<58?r+=46:2==turn&&63<r?r=63:3==turn&&e<=24&&24<r&&r<64?r+=39:3==turn&&69<r?r=69:4==turn&&e<=37&&37<r&&r<70?r+=32:4==turn&&75<r?r=75:1!=turn&&51<r&&(r-=51),r},resetGame=e=>{turn=1,step="dice",home=[4,4,4,4],path=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],render(),toast(`<button onclick="mode='cpu';showHelp()">Auto CPU</button> or <button onclick="mode='pass';showHelp()">Pass-N-Play</button>`,!1)},showHelp=e=>{isTouchDevice()?toast("Touch to play."):toast("Click to play. R to reset."),render()},render=e=>{html=`
    <div id="map">`+row6(1)+square(23)+square(24)+square(25)+row6(2)+row6(1,2==turn&&2,0,diceImg())+square(22)+square(64,color[2])+square(26,color[2])+row6(2,3==turn&&2,0,diceImg())+row6(1,1<=home[1]?4:0)+square(21,color[2])+square(65,color[2])+square(27)+row6(2,1<=home[2]?4:0)+row6(1,2<=home[1]?3:0,3<=home[1]?5:0)+square(20)+square(66,color[2])+square(28)+row6(2,2<=home[2]?3:0,3<=home[2]?5:0)+row6(1,4<=home[1]?4:0)+square(19)+square(67,color[2])+square(29)+row6(2,4<=home[2]?4:0)+row6(1)+square(18)+square(68,color[2])+square(30)+row6(2)+square(12)+square(13,color[1])+square(14)+square(15)+square(16)+square(17)+square(-1,"white")+square(69,color[2])+square(-1,"white")+square(31)+square(32)+square(33)+square(34,color[3])+square(35)+square(36)+square(11)+square(58,color[1])+square(59,color[1])+square(60,color[1])+square(61,color[1])+square(62,color[1])+square(63,color[1])+square(-1,"white")+square(75,color[3])+square(74,color[3])+square(73,color[3])+square(72,color[3])+square(71,color[3])+square(70,color[3])+square(37)+square(10)+square(9)+square(8,color[1])+square(7)+square(6)+square(5)+square(-1,"white")+square(57,color[0])+square(-1,"white")+square(43)+square(42)+square(41)+square(40)+square(39,color[3])+square(38)+row6(0)+square(4)+square(56,color[0])+square(44)+row6(3)+row6(0,1==turn&&2,0,diceImg())+square(3)+square(55,color[0])+square(45)+row6(3,4==turn&&2,0,diceImg())+row6(0,1<=home[0]?4:0)+square(2)+square(54,color[0])+square(46)+row6(3,1<=home[3]?4:0)+row6(0,2<=home[0]?3:0,3<=home[0]?5:0)+square(1)+square(53,color[0])+square(47,color[0])+row6(3,2<=home[3]?3:0,3<=home[3]?5:0)+row6(0,4<=home[0]?4:0)+square(0,color[0])+square(52,color[0])+square(48)+row6(3,4<=home[3]?4:0)+row6(0)+square(51)+square(50)+square(49)+row6(3)+`</div>
    `,document.querySelector("#root").innerHTML=html,autotesting()},playDice=e=>{dice=diceroll(),("cpu"==mode?playCPU:checkMove)(),render()},moveTokenOut=e=>{home[turn-1]--,path[safehouses[turn-1]]=turn,render()},checkMove=e=>{let o=!1;6!=dice&&4==home[turn-1]||4==home[turn-1]&&path[safehouses[turn-1]]?o=!0:6!=dice||4!=home[turn-1]||path[safehouses[turn-1]]||(moveTokenOut(),o=!0),o?(step="dice",gameStep()):step="play"},playCPU=e=>{if(6==dice&&home[turn-1]&&!path[safehouses[turn-1]])moveTokenOut();else for(let e=0;e<51;e++)if(path[e]==turn)return void playToken(e);gameStep()},playToken=e=>{step="dice";var o=nextIndex(e);let r=!1;path[o]&&(path[o]==turn||-1!=safehouses.indexOf(o))||(path[o]&&-1==safehouses.indexOf(o)&&(r=!0,home[path[o]-1]++,c("capture-- turn:"+turn,"dice:"+dice,"index:"+e,"nextIndex:"+o,"onpath:"+path[o])),path[o]=turn,path[e]=0,gameStep(!r))},gameStep=(e=!0)=>{var o,r=path[57]||path[63]||path[69]||path[75];r&&(o=1==r?"Green":2==r?"Blue":3==r?"Red":"Yellow",toast(`Game Over ! <span style="background:white; color:${tokenColors[r-1]}">♟</span> ${o} won !`),setTimeout(()=>{resetGame()},5e3)),e&&(6!=dice&&(turn+=1),4<turn)&&(turn=1),render()},autotesting=e=>{if(testing){nextIndex(0,1);for(let o=1;o<=4;o++)path.filter(e=>e==o).length,home[o-1]}},toast=(e,o=!0)=>{document.querySelector("#toaster").style.opacity=1,document.querySelector("#toaster").innerHTML=e,stopInput=!o,o&&setTimeout(closeToast,2e3)},closeToast=e=>{stopInput=!1,document.querySelector("#toaster").style.opacity=0};resetGame(),window.addEventListener("keydown",keypress),isTouchDevice()?document.body.addEventListener("touchstart",clickIndex,!0):document.body.addEventListener("click",clickIndex,!0);